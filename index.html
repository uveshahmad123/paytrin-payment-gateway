<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paytring Payment Gateway</title>
    <script src="https://cdn.paytring.com/js/checkout/iframe.v1.2.0.js"></script>
</head>

<body>
    <h1>Pay Now</h1>
    <button id="pay-button">Proceed to Payment</button>
    <div id="payment-container" style="display: none;"></div>

    <script>
        // Function to handle payment gateway initialization
        async function initializePayment() {
            try {
                console.log("Hit the API")
                // Replace this with your backend API call to create an order
                const response = await fetch('https://api.paytring.com/api/v2/order/create/', {
                    method: 'POST',
                    headers: {
                        accept: 'application/json',
                        'content-type': 'application/json',
                        authorization: 'Basic dGVzdF9rZXk6dGVzdF9zZWNyZXQ='
                    },
                    body: JSON.stringify({
                        key: 'test_123',
                        amount: 2000,
                        cname: 'Uvesh Ahmed',
                        phone: '9319357641',
                        receipt_id: 'xx04562',
                        callback_url: 'http://localhost:8083/api/callback',
                        currency: 'INR',
                        split_type: 'percent',
                        autocapture: 'true',
                        hash: 'uveshahmad',
                        email: 'uveshahmad30@gmail.com'
                    })
                });

                const data = await response.json();
                console.log("data--->", data)
                if (!data.order_id) throw new Error('Failed to generate order');

                // Use the Paytring class from the CDN to initialize the iframe
                const paytring = new Paytring({
                    order_id: data.order_id, // Order ID from backend
                    success: (orderId) => {
                        alert(`Payment Successful! Order ID: ${orderId}`);
                    },
                    failed: (orderId) => {
                        alert(`Payment Failed! Order ID: ${orderId}`);
                    },
                    onClose: (orderId) => {
                        alert(`Payment Popup Closed! Order ID: ${orderId}`);
                    },
                    events: (event) => {
                        console.log(`Event Triggered: ${event.event_name} - ${event.event_value}`);
                    }
                });

                // Display the payment container and open the iframe
                document.getElementById('payment-container').style.display = 'block';
                paytring.open();
            } catch (error) {
                console.error('Error initializing payment:', error);
                alert('Failed to initialize payment. Please try again.');
            }
        }

        // Add event listener to the "Pay Now" button
        document.getElementById('pay-button').addEventListener('click', initializePayment);
    </script>
</body>

</html>